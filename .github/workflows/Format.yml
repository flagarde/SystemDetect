name: 'Format'

on:
    push:
    pull_request:

jobs:
  format:
    name: 'ðŸ’Ž Format'
    runs-on: ubuntu-latest
    steps:

    - name: 'ðŸ§° Checkout'
      uses: actions/checkout@v3.0.1
      with:
        fetch-depth: 0

    - name: 'ðŸŸ¨ Use clang-format'
      uses: DoozyX/clang-format-lint-action@v0.12
      with:
        source: '.'
        clangFormatVersion: 12
        inplace: True

    - name: 'ðŸŸ¨ Setup Python'
      uses: actions/setup-python@v2

    - name: 'ðŸŸ¨ Install cmakelang'
      uses: BSFishy/pip-action@v1
      with:
        packages: cmakelang pyyaml jinja2

    - name: 'ðŸŸ¨ Use cmake-format'
      run: find . \( -name '*.cmake' -o -name 'CMakeLists.txt' \) -exec cmake-format -i {} \;

    - name: 'ðŸ“¨ Use Commit'
      uses: EndBug/add-and-commit@v7.2.1
      with:
        default_author: github_actions
        message: 'Committing clang-format changes'
      env:
        GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
